- Start Date: (fill me in with today's date, YYYY-MM-DD)
- RFC PR: [amaranth-lang/rfcs#0000](https://github.com/amaranth-lang/rfcs/pull/0000)
- Amaranth Issue: [amaranth-lang/amaranth#0000](https://github.com/amaranth-lang/amaranth/issues/0000)

# GPIO peripheral RFC

## Summary
[summary]: #summary

Add a SoC peripheral to control GPIO pins.

## Motivation
[motivation]: #motivation

[GPIOs](https://en.wikipedia.org/wiki/General-purpose_input/output) are useful for a wide range of scenarios, such as driving external circuitry or acting as fallback for unimplemented/misbehaving peripherals in early iterations of a design.

Amaranth SoC seems like an appropriate place for a GPIO peripheral, which depends on features that are already provided by the library. Due to its relative simplicity, it is also a good candidate for using the recent CSR register API in realistic conditions.

## Guide-level explanation
[guide-level-explanation]: #guide-level-explanation

### Usage

```python3
from amaranth import *
from amaranth.lib import wiring
from amaranth.lib.wiring import connect

from amaranth_soc import csr
from amaranth_soc.csr.gpio import GPIOPeripheral


class MySoC(wiring.Component):
    def elaborate(self, platform):
        m = Module()

        # ...

        # Use a GPIO peripheral to control four LEDs:
        m.submodules.gpio = gpio = GPIOPeripheral(addr_width=8, data_width=8, pin_count=4)
        for n in range(4):
            connect(m, gpio.pins[n], platform.request("led", n))

        # Add the peripheral to a CSR bus decoder:
        m.submodules.csr_decoder = csr_decoder = csr.Decoder(addr_width=31, data_width=8)
        csr_decoder.add(gpio.bus, addr=0x1000)

        # ...

        return m
```

### Overview

The following figure is a simplified diagram of the peripheral. CSR registers are on the left-hand side, a single pin is on the right side:

<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 633.0307957515297 345" width="633.0307957515297" height="345">
  <!-- svg-source:excalidraw -->
  
  <defs>
    <style class="style-fonts">
      @font-face {
        font-family: "Virgil";
        src: url("https://excalidraw.com/Virgil.woff2");
      }
      @font-face {
        font-family: "Cascadia";
        src: url("https://excalidraw.com/Cascadia.woff2");
      }
      @font-face {
        font-family: "Assistant";
        src: url("https://excalidraw.com/Assistant-Regular.woff2");
      }
    </style>
    
  </defs>
  <rect x="0" y="0" width="633.0307957515297" height="345" fill="#ffffff"></rect><g stroke-linecap="round" transform="translate(12 10) rotate(0 62 25)"><path d="M0 0 C42.52 0.69, 88.36 -0.7, 124 0 M0 0 C40.38 -0.92, 81.34 -0.47, 124 0 M124 0 C126.26 10.48, 126.12 19.52, 124 50 M124 0 C124.37 11.03, 123.52 20.88, 124 50 M124 50 C88.53 49.28, 52.95 49.33, 0 50 M124 50 C95.85 51.69, 69.14 50.95, 0 50 M0 50 C1.95 37.07, 1.13 24.02, 0 0 M0 50 C-0.56 32.45, 1.23 15.45, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(36 23) rotate(0 37.82997131347656 12.5)"><text x="37.82997131347656" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">I_SYNC</text></g><g stroke-linecap="round" transform="translate(11 71) rotate(0 62 25)"><path d="M0 0 C28.75 -0.84, 60.2 0.92, 124 0 M0 0 C44.08 -0.09, 88.32 -0.06, 124 0 M124 0 C123.31 18.1, 125.47 38.91, 124 50 M124 0 C123.62 11, 123.01 20.84, 124 50 M124 50 C74.2 49.57, 24.29 50.48, 0 50 M124 50 C85.92 50.73, 46.92 51.49, 0 50 M0 50 C-0.22 35.59, -0.27 22.7, 0 0 M0 50 C0.28 36.48, 0.8 24.67, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(35 84) rotate(0 42.66997528076172 12.5)"><text x="42.66997528076172" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">I_DATA</text></g><g stroke-linecap="round" transform="translate(10 148) rotate(0 62 25)"><path d="M0 0 C43.03 1.17, 83.93 -0.91, 124 0 M0 0 C41.09 0.33, 84.54 -0.13, 124 0 M124 0 C122.83 13.56, 123.35 26.35, 124 50 M124 0 C123.22 13.76, 123.44 28.07, 124 50 M124 50 C74.32 49.51, 27.36 48.76, 0 50 M124 50 C82.59 49.22, 40.37 48.27, 0 50 M0 50 C-0.4 34.94, 1.93 19.26, 0 0 M0 50 C-0.18 30.49, -0.01 12.94, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(34 161) rotate(0 44.47997283935547 12.5)"><text x="44.47997283935547" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">O_DATA</text></g><g stroke-linecap="round" transform="translate(10 207) rotate(0 62 25)"><path d="M0 0 C46.79 2.26, 92.98 0.22, 124 0 M0 0 C42.22 0.43, 84.05 0.73, 124 0 M124 0 C123.04 10.7, 122.76 23.91, 124 50 M124 0 C123.71 13.21, 123.34 26.07, 124 50 M124 50 C76.25 52.39, 26.18 51.07, 0 50 M124 50 C98.85 50.17, 73.4 50.24, 0 50 M0 50 C-1.57 33.88, 1.2 16.92, 0 0 M0 50 C0.75 36.04, 0.78 23.16, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(34 220) rotate(0 41.949974060058594 12.5)"><text x="41.949974060058594" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">O_MASK</text></g><g stroke-linecap="round" transform="translate(11 285) rotate(0 62 25)"><path d="M0 0 C34.85 1.02, 69.55 0.78, 124 0 M0 0 C37.45 0.64, 77.44 0.88, 124 0 M124 0 C123.52 18.43, 121.74 32.74, 124 50 M124 0 C123 11.06, 122.73 20.82, 124 50 M124 50 C86.94 49.57, 49.13 47.87, 0 50 M124 50 C97.29 50.72, 71.78 49.71, 0 50 M0 50 C-0.61 36.85, -0.23 23.34, 0 0 M0 50 C-0.21 35.35, 0.96 20.44, 0 0" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g><g transform="translate(44 298) rotate(0 29.459976196289062 12.5)"><text x="0" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">MODE</text></g><g stroke-linecap="round"><g transform="translate(572.0018063987059 76.6397434389105) rotate(0 -49.57541171995376 0)"><path d="M0 0 C-21.7 -0.3, -46.72 -0.48, -99.15 0 M0 0 C-21.99 0.03, -44.02 0.12, -99.15 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(502.23846946776325 77.19890920617485) rotate(0 0.3387486508964912 23.42458828004621)"><path d="M0 0 C0.23 17.24, 0.06 33.88, 0.68 46.85 M0 0 C-0.04 11.34, 0.23 23.47, 0.68 46.85" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(503.91596676955623 123.04808576626726) rotate(0 -55.5 -1)"><path d="M0 0 C-33.71 -1.16, -65.01 0.18, -111 -2 M0 0 C-38 -1.18, -77.5 -2.17, -111 -2" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(421.74428751125674 77.1664173007959) rotate(0 -16.289160370850254 -0.184165767264318)"><path d="M0 0 C-10.44 -0.72, -21.68 -0.54, -32.58 -0.37 M0 0 C-9 -0.32, -17.8 0.21, -32.58 -0.37" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(387.7909667695561 60.92308576626729) rotate(0 0.3125 43.437499999999986)"><path d="M0 0 C0.86 22.95, 0.61 42.98, 0.63 86.87 M0 0 C1.62 17.6, 0.08 36.66, 0.63 86.87" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(387.1659667695561 59.04808576626735) rotate(0 -10 9.6875)"><path d="M0 0 C-8.17 7.49, -16.06 13.92, -20 19.38 M0 0 C-5.36 5.22, -11.02 10.22, -20 19.38" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(387.1659667695561 147.79808576626732) rotate(0 -9.6875 -6.875000000000014)"><path d="M0 0 C-4.58 -4.32, -9.97 -7.5, -19.38 -13.75 M0 0 C-7.97 -5.55, -15.01 -10.97, -19.38 -13.75" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(367.7909667695561 77.17308576626735) rotate(0 -0.3125 28.43749999999997)"><path d="M0 0 C-1.2 20.67, -1.58 39.87, -0.63 56.87 M0 0 C0.09 12.96, 0.17 25.72, -0.63 56.87" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(365.91596676955623 119.67308576626732) rotate(0 -69.74860678346096 -0.19594262041056254)"><path d="M0 0 C-41.19 -2.73, -84.95 -0.5, -139.5 -0.39 M0 0 C-53.35 -0.39, -106.53 -0.62, -139.5 -0.39" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(332.16596676955623 118.42308576626732) rotate(0 -0.3125 -21.562499999999986)"><path d="M0 0 C-1.04 -11.93, 0.26 -23.73, -0.63 -43.12 M0 0 C-0.23 -13.7, -0.44 -27.31, -0.63 -43.12" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(330.91596676955623 74.67308576626735) rotate(0 -9.499721782137044 0.06259273928765197)"><path d="M0 0 C-4.03 -0.4, -10.48 0.7, -19 0.13 M0 0 C-3.94 0.32, -8.25 0.47, -19 0.13" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(261.16819765816604 60.15596893910424) rotate(0 25.003338614355528 15.252874917917268)"><path d="M0 0 C12.01 0.34, 24.19 0.69, 50.01 0 M0 0 C16.34 -0.17, 33.61 -0.05, 50.01 0 M50.01 0 C50.24 8.6, 49.5 20.67, 50.01 30.51 M50.01 0 C50.42 11.19, 49.1 24.61, 50.01 30.51 M50.01 30.51 C32.07 31.29, 10.91 29.07, 0 30.51 M50.01 30.51 C34.38 30.04, 20.08 30.45, 0 30.51 M0 30.51 C-0.24 20.7, -0.35 8.49, 0 0 M0 30.51 C0.43 20.1, -0.87 7.54, 0 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(262.1174742917224 63.9064326355425) rotate(0 2.901149967166873 2.175862475375169)"><path d="M0 0 C2.08 1.48, 3.82 2.7, 5.8 4.35 M0 0 C1.3 0.97, 2.7 2.12, 5.8 4.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(267.43624923152834 67.77463259176503) rotate(0 -2.659387469902981 1.6923374808473568)"><path d="M0 0 C-1.62 1.03, -3.56 2.06, -5.32 3.38 M0 0 C-1.31 0.92, -2.63 1.68, -5.32 3.38" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(224.79602270017654 53.52070778106042) rotate(0 0.3125 43.4375)"><path d="M0 0 C-1.48 25.32, -1.32 47.07, 0.63 86.87 M0 0 C-0.21 30.93, 0.55 60.11, 0.63 86.87" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(224.17102270017654 51.64570778106042) rotate(0 -10 9.6875)"><path d="M0 0 C-8.51 6.72, -14.89 15.18, -20 19.38 M0 0 C-4.17 3.72, -7.7 8.23, -20 19.38" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(224.17102270017654 140.39570778106042) rotate(0 -9.6875 -6.875000000000014)"><path d="M0 0 C-6.28 -4.61, -14.57 -10.44, -19.38 -13.75 M0 0 C-6.59 -4.67, -13.96 -9.67, -19.38 -13.75" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(204.79602270017654 69.77070778106042) rotate(0 -0.3125 28.43749999999997)"><path d="M0 0 C-1.84 11.45, 1.24 25.34, -0.63 56.87 M0 0 C0.46 14.97, 0.11 28.21, -0.63 56.87" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(260.2886900390829 77.21942643376246) rotate(0 -18.037524649779016 0.1676537730245684)"><path d="M0 0 C-10.42 -0.6, -19.67 -0.15, -36.08 0.34 M0 0 C-9.57 0.5, -19.14 0.39, -36.08 0.34" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(136.28067112085398 33.4041444113073) rotate(0 120.18032162350227 0.4216853390298212)"><path d="M0 0 C60.46 1.93, 123.13 1.98, 240.36 0.84 M0 0 C73.02 -0.8, 144.42 -0.35, 240.36 0.84" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(211.34066146816417 35.09088576742661) rotate(0 0 14.75898686604414)"><path d="M0 0 C0.22 6.25, -0.66 11.81, 0 29.52 M0 0 C0.52 10.57, 0.4 21.36, 0 29.52" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(375.7979436897988 35.09088576742661) rotate(0 0.8433706780597277 17.289098900223138)"><path d="M0 0 C1.03 13.59, 1.9 27.08, 1.69 34.58 M0 0 C0.67 13.64, 1.3 27.39, 1.69 34.58" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(573.0206136709551 54.401452793571366) rotate(0 21.927637629551327 21.084266951491614)"><path d="M10.54 0 C20.47 0.05, 29.27 -1.89, 33.31 0 M10.54 0 C18.24 -1.06, 28.7 -0.96, 33.31 0 M33.31 0 C39.98 0.29, 45.68 3.71, 43.86 10.54 M33.31 0 C40.03 1.17, 45.77 5.14, 43.86 10.54 M43.86 10.54 C44.13 18.17, 43.43 22.1, 43.86 31.63 M43.86 10.54 C42.97 15.33, 44.34 18.99, 43.86 31.63 M43.86 31.63 C42.35 38.96, 41.35 43.58, 33.31 42.17 M43.86 31.63 C45.83 40.11, 39.81 43.84, 33.31 42.17 M33.31 42.17 C29.26 40.8, 25.3 40.81, 10.54 42.17 M33.31 42.17 C27.08 42.02, 19.56 42.45, 10.54 42.17 M10.54 42.17 C2.94 42.69, 1.22 40.62, 0 31.63 M10.54 42.17 C2.63 43.3, 2.25 37.57, 0 31.63 M0 31.63 C0.81 25.84, 1.09 19.13, 0 10.54 M0 31.63 C-0.01 25.2, 0.77 18.93, 0 10.54 M0 10.54 C0.14 5.44, 3.53 0.54, 10.54 0 M0 10.54 C-1.56 2.94, 4.81 1.39, 10.54 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(589.4982543522642 62.985719745062966) rotate(0 5.4499969482421875 12.5)"><text x="5.4499969482421875" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">I</text></g><g stroke-linecap="round"><g transform="translate(133.75055908667497 172.56030629115202) rotate(0 36.26493915656559 -0.8433706780596708)"><path d="M-0.49 0.03 C11.52 -0.09, 60.9 -1.42, 73.11 -1.8 M1.45 -1.01 C13.27 -0.82, 60.69 -0.29, 72.47 -0.33" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(134.59392976473464 234.9697364675672) rotate(0 33.734827122386605 -1.2650560170895062)"><path d="M-1.05 -0.36 C10.18 -0.8, 55.08 -2.42, 66.34 -2.74 M0.6 -1.59 C12.27 -1.84, 57.07 -1.43, 68.46 -1.31" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(203.75032536562708 171.71693561309235) rotate(0 -0.421685339029807 30.36134441014792)"><path d="M1.09 0.17 C1.18 10.55, -0.21 51.26, -0.6 61.32 M0.2 -0.79 C0.25 9.32, -1.01 49.09, -1.43 59.51" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(579.0502771021779 182.680754427868) rotate(0 21.92763762955127 20.240896273431957)"><path d="M10.12 0 C17.44 -1.43, 23.75 0.36, 33.73 0 M10.12 0 C17.79 -0.76, 26.35 0.33, 33.73 0 M33.73 0 C40.79 -0.7, 43.68 3.06, 43.86 10.12 M33.73 0 C41.32 -0.62, 45.63 1.19, 43.86 10.12 M43.86 10.12 C44.51 15.9, 44.79 18.62, 43.86 30.36 M43.86 10.12 C43.51 15.86, 44.49 20.12, 43.86 30.36 M43.86 30.36 C43.03 35.88, 40.31 38.74, 33.73 40.48 M43.86 30.36 C42.04 39.32, 38.25 38.34, 33.73 40.48 M33.73 40.48 C25.27 42.62, 19.82 42.05, 10.12 40.48 M33.73 40.48 C24.95 40.17, 16.96 40.77, 10.12 40.48 M10.12 40.48 C3.86 39.48, 1.92 36.16, 0 30.36 M10.12 40.48 C2.64 39.37, -0.55 38.52, 0 30.36 M0 30.36 C-2.06 25.33, 0.7 16.95, 0 10.12 M0 30.36 C-0.64 25.03, 0.45 18.97, 0 10.12 M0 10.12 C-0.52 3.79, 2.55 -1.84, 10.12 0 M0 10.12 C-0.58 5.17, 5.36 -0.23, 10.12 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(593.7179202248932 190.4216507013) rotate(0 7.2599945068359375 12.5)"><text x="7.2599945068359375" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">O</text></g><g stroke-linecap="round" transform="translate(422.8694297433707 60.151647903477084) rotate(0 25.003338614355528 15.252874917917268)"><path d="M0 0 C16.92 0.62, 39.62 1.22, 50.01 0 M0 0 C19.17 0.15, 36.2 0.08, 50.01 0 M50.01 0 C49.24 6.54, 48.32 13.69, 50.01 30.51 M50.01 0 C50.4 7.81, 50.72 13.03, 50.01 30.51 M50.01 30.51 C40.63 31.96, 27.26 32.1, 0 30.51 M50.01 30.51 C33.51 31.88, 15.59 31.33, 0 30.51 M0 30.51 C1.48 18.31, -0.95 9.73, 0 0 M0 30.51 C0.04 19.84, -0.4 8.6, 0 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g stroke-linecap="round"><g transform="translate(423.818706376927 63.902111599915344) rotate(0 2.901149967166873 2.175862475375169)"><path d="M0 0 C1.47 1.03, 2.66 1.94, 5.8 4.35 M0 0 C1.69 1.33, 3.46 2.55, 5.8 4.35" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(429.137481316733 67.7703115561379) rotate(0 -2.659387469902981 1.6923374808473568)"><path d="M0 0 C-1.49 1.11, -3.28 2.26, -5.32 3.38 M0 0 C-1.77 0.99, -3.43 2.12, -5.32 3.38" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(134.80282458390457 311.03208843616636) rotate(0 221.03217473322405 0.9686318786474999)"><path d="M0 0 C90.13 -1.04, 182.31 -0.5, 442.06 1.94 M0 0 C101.98 2.47, 204.44 2.93, 442.06 1.94" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(134.80282458390457 311.03208843616636) rotate(0 221.03217473322405 0.9686318786474999)"><path d="M443.62 1.68 L427.91 10.13 L426.84 -4.97 L442.62 3.82" stroke="none" stroke-width="0" fill="#1e1e1e" fill-rule="evenodd"></path><path d="M442.06 1.94 C438.36 3.2, 437.8 4.73, 428.49 8.31 M442.06 1.94 C438.75 3.43, 436.19 4.93, 428.49 8.31 M428.49 8.31 C428.96 4.14, 428.01 2.25, 428.45 -4.37 M428.49 8.31 C428.23 5.85, 428.38 2.9, 428.45 -4.37 M428.45 -4.37 C432.87 -1.56, 438.26 0.22, 442.06 1.94 M428.45 -4.37 C431.24 -3.35, 434.56 -1.88, 442.06 1.94 M442.06 1.94 C442.06 1.94, 442.06 1.94, 442.06 1.94 M442.06 1.94 C442.06 1.94, 442.06 1.94, 442.06 1.94" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(205.57189807305087 200.5160010695543) rotate(0 185.64763798865096 1.938878725730035)"><path d="M0 0 C116.98 0.44, 235.8 -0.02, 371.3 3.88 M0 0 C130.11 0.06, 259.49 1.66, 371.3 3.88" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(205.57189807305087 200.5160010695543) rotate(0 185.64763798865096 1.938878725730035)"><path d="M369.56 3.25 L359.3 8.33 L355.82 -2.88 L370.82 5.06" stroke="none" stroke-width="0" fill="#1e1e1e" fill-rule="evenodd"></path><path d="M371.3 3.88 C366.32 7.41, 363.58 7.28, 357.59 9.98 M371.3 3.88 C366.57 5.53, 360.98 7.96, 357.59 9.98 M357.59 9.98 C358.3 7.7, 358.19 2.61, 357.81 -2.69 M357.59 9.98 C356.98 7.42, 358.04 3.57, 357.81 -2.69 M357.81 -2.69 C361.58 -1.28, 366.28 1.14, 371.3 3.88 M357.81 -2.69 C361.3 -0.23, 366.14 1.84, 371.3 3.88 M371.3 3.88 C371.3 3.88, 371.3 3.88, 371.3 3.88 M371.3 3.88 C371.3 3.88, 371.3 3.88, 371.3 3.88" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(203.63301934732078 99.69430733159243) rotate(0 -33.93037770027561 -0.48471968143249455)"><path d="M0 0 C-17 -1.82, -32.41 1.05, -67.86 -0.97 M0 0 C-19.27 0.76, -38.18 0.19, -67.86 -0.97" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(203.63301934732078 99.69430733159243) rotate(0 -33.93037770027561 -0.48471968143249455)"><path d="M-66.71 -1.75 L-53.27 -6.7 L-55.82 4.25 L-68.47 -0.99" stroke="none" stroke-width="0" fill="#1e1e1e" fill-rule="evenodd"></path><path d="M-67.86 -0.97 C-65.64 -3.6, -62.24 -2.63, -54.05 -6.82 M-67.86 -0.97 C-63.75 -2.05, -59.4 -3.94, -54.05 -6.82 M-54.05 -6.82 C-53.37 -3.24, -54.57 0.95, -54.5 5.85 M-54.05 -6.82 C-53.97 -1.85, -54.46 1.92, -54.5 5.85 M-54.5 5.85 C-58.53 5.24, -61.58 1.36, -67.86 -0.97 M-54.5 5.85 C-57.75 4.71, -61.01 2.22, -67.86 -0.97 M-67.86 -0.97 C-67.86 -0.97, -67.86 -0.97, -67.86 -0.97 M-67.86 -0.97 C-67.86 -0.97, -67.86 -0.97, -67.86 -0.97" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(579.1755204924272 286.9134347112743) rotate(0 21.92763762955127 20.240896273431957)"><path d="M10.12 0 C19.18 0.34, 24.11 1.49, 33.73 0 M10.12 0 C15.32 -0.41, 21.63 -0.34, 33.73 0 M33.73 0 C39.99 1.95, 43.66 2.74, 43.86 10.12 M33.73 0 C38.75 0.67, 43.85 5.3, 43.86 10.12 M43.86 10.12 C43.05 16.94, 42.39 26.05, 43.86 30.36 M43.86 10.12 C43.56 17.66, 43.75 25.42, 43.86 30.36 M43.86 30.36 C42.5 36.77, 39.43 38.92, 33.73 40.48 M43.86 30.36 C44.05 36.34, 40.84 38.55, 33.73 40.48 M33.73 40.48 C28.75 39.66, 20 40.17, 10.12 40.48 M33.73 40.48 C28.5 40.09, 22.83 39.8, 10.12 40.48 M10.12 40.48 C4.5 38.73, 1.75 38.81, 0 30.36 M10.12 40.48 C1.45 42.27, 1.68 35.61, 0 30.36 M0 30.36 C2 23.67, -1.5 17.05, 0 10.12 M0 30.36 C-0.11 25.65, 0.62 21.25, 0 10.12 M0 10.12 C-1.56 4.81, 1.89 -0.47, 10.12 0 M0 10.12 C-1.01 2.55, 1.59 -0.59, 10.12 0" stroke="#1e1e1e" stroke-width="1" fill="none"></path></g><g transform="translate(587.1031733807674 294.65433098470623) rotate(0 13.999984741210938 12.5)"><text x="13.999984741210938" y="0" font-family="Virgil, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="text-before-edge">OE</text></g></svg>

### Registers

#### MODE (read/write)

<svg xmlns="http://www.w3.org/2000/svg" width="800" height="70" viewBox="0 0 800 70" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(0.5,0.5)" text-anchor="middle" font-size="14" font-family="sans-serif" font-weight="normal"><g transform="translate(4,21)"><g stroke="black" stroke-width="1" stroke-linecap="round"><line x2="791"/><line y2="31"/><line x2="791" y1="31" y2="31"/><line x1="791" x2="791" y2="31"/><line x1="766" x2="766" y2="3"/><line x1="766" x2="766" y1="31" y2="28"/><line x1="742" x2="742" y2="31"/><line x1="717" x2="717" y2="3"/><line x1="717" x2="717" y1="31" y2="28"/><line x1="692" x2="692" y2="31"/><line x1="667" x2="667" y2="3"/><line x1="667" x2="667" y1="31" y2="28"/><line x1="643" x2="643" y2="31"/><line x1="618" x2="618" y2="3"/><line x1="618" x2="618" y1="31" y2="28"/><line x1="593" x2="593" y2="31"/><line x1="569" x2="569" y2="3"/><line x1="569" x2="569" y1="31" y2="28"/><line x1="544" x2="544" y2="31"/><line x1="519" x2="519" y2="3"/><line x1="519" x2="519" y1="31" y2="28"/><line x1="494" x2="494" y2="31"/><line x1="470" x2="470" y2="3"/><line x1="470" x2="470" y1="31" y2="28"/><line x1="445" x2="445" y2="31"/><line x1="420" x2="420" y2="3"/><line x1="420" x2="420" y1="31" y2="28"/><line x1="396" x2="396" y2="31"/><line x1="371" x2="371" y2="3"/><line x1="371" x2="371" y1="31" y2="28"/><line x1="346" x2="346" y2="31"/><line x1="321" x2="321" y2="3"/><line x1="321" x2="321" y1="31" y2="28"/><line x1="297" x2="297" y2="31"/><line x1="272" x2="272" y2="3"/><line x1="272" x2="272" y1="31" y2="28"/><line x1="247" x2="247" y2="31"/><line x1="222" x2="222" y2="3"/><line x1="222" x2="222" y1="31" y2="28"/><line x1="198" x2="198" y2="31"/><line x1="173" x2="173" y2="3"/><line x1="173" x2="173" y1="31" y2="28"/><line x1="148" x2="148" y2="31"/><line x1="124" x2="124" y2="3"/><line x1="124" x2="124" y1="31" y2="28"/><line x1="99" x2="99" y2="31"/><line x1="74" x2="74" y2="3"/><line x1="74" x2="74" y1="31" y2="28"/><line x1="49" x2="49" y2="31"/><line x1="25" x2="25" y2="3"/><line x1="25" x2="25" y1="31" y2="28"/></g><g><g/><g transform="translate(12,-11)"><g transform="translate(766)"><text y="6">0</text></g><g transform="translate(742)"><text y="6">1</text></g><g transform="translate(717)"><text y="6">2</text></g><g transform="translate(692)"><text y="6">3</text></g><g transform="translate(667)"><text y="6">4</text></g><g transform="translate(643)"><text y="6">5</text></g><g transform="translate(618)"><text y="6">6</text></g><g transform="translate(593)"><text y="6">7</text></g><g transform="translate(569)"><text y="6">8</text></g><g transform="translate(544)"><text y="6">9</text></g><g transform="translate(519)"><text y="6">10</text></g><g transform="translate(494)"><text y="6">11</text></g><g transform="translate(470)"><text y="6">12</text></g><g transform="translate(445)"><text y="6">13</text></g><g transform="translate(420)"><text y="6">14</text></g><g transform="translate(396)"><text y="6">15</text></g><g transform="translate(371)"><text y="6">16</text></g><g transform="translate(346)"><text y="6">17</text></g><g transform="translate(321)"><text y="6">18</text></g><g transform="translate(297)"><text y="6">19</text></g><g transform="translate(272)"><text y="6">20</text></g><g transform="translate(247)"><text y="6">21</text></g><g transform="translate(222)"><text y="6">22</text></g><g transform="translate(198)"><text y="6">23</text></g><g transform="translate(173)"><text y="6">24</text></g><g transform="translate(148)"><text y="6">25</text></g><g transform="translate(124)"><text y="6">26</text></g><g transform="translate(99)"><text y="6">27</text></g><g transform="translate(74)"><text y="6">28</text></g><g transform="translate(49)"><text y="6">29</text></g><g transform="translate(25)"><text y="6">30</text></g><g transform="translate(0)"><text y="6">31</text></g></g><g transform="translate(12,15)"><g transform="translate(754)"><text y="6"><tspan>M0</tspan></text></g><g transform="translate(704)"><text y="6"><tspan>M1</tspan></text></g><g transform="translate(655)"><text y="6"><tspan>M2</tspan></text></g><g transform="translate(606)"><text y="6"><tspan>M3</tspan></text></g><g transform="translate(556)"><text y="6"><tspan>M4</tspan></text></g><g transform="translate(507)"><text y="6"><tspan>M5</tspan></text></g><g transform="translate(457)"><text y="6"><tspan>M6</tspan></text></g><g transform="translate(408)"><text y="6"><tspan>M7</tspan></text></g><g transform="translate(358)"><text y="6"><tspan>M8</tspan></text></g><g transform="translate(309)"><text y="6"><tspan>M9</tspan></text></g><g transform="translate(260)"><text y="6"><tspan>M10</tspan></text></g><g transform="translate(210)"><text y="6"><tspan>M11</tspan></text></g><g transform="translate(161)"><text y="6"><tspan>M12</tspan></text></g><g transform="translate(111)"><text y="6"><tspan>M13</tspan></text></g><g transform="translate(62)"><text y="6"><tspan>M14</tspan></text></g><g transform="translate(12)"><text y="6"><tspan>M15</tspan></text></g></g><g transform="translate(12,39)"><g transform="translate(754)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(704)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(655)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(606)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(556)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(507)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(457)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(408)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(358)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(309)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(260)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(210)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(161)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(111)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(62)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(12)"><text y="6"><tspan>RW</tspan></text></g></g></g></g></g></svg>

Each `Mx` field can hold the following values:

```python3
class Mode(enum.IntEnum, shape=unsigned(2)):
    INPUT  = 0b00
    OUTPUT = 0b01
    _2     = 0b10 # reserved
    _3     = 0b11 # reserved
```

If a `MODE.Mx` field is set to `OUTPUT`, then `self.pins[x].oe` is driven high.

#### I_SYNC (read/write)

<svg xmlns="http://www.w3.org/2000/svg" width="800" height="70" viewBox="0 0 800 70" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(0.5,0.5)" text-anchor="middle" font-size="14" font-family="sans-serif" font-weight="normal"><g transform="translate(4,21)"><g stroke="black" stroke-width="1" stroke-linecap="round"><line x2="791"/><line y2="31"/><line x2="791" y1="31" y2="31"/><line x1="791" x2="791" y2="31"/><line x1="766" x2="766" y2="3"/><line x1="766" x2="766" y1="31" y2="28"/><line x1="742" x2="742" y2="31"/><line x1="717" x2="717" y2="3"/><line x1="717" x2="717" y1="31" y2="28"/><line x1="692" x2="692" y2="31"/><line x1="667" x2="667" y2="3"/><line x1="667" x2="667" y1="31" y2="28"/><line x1="643" x2="643" y2="31"/><line x1="618" x2="618" y2="3"/><line x1="618" x2="618" y1="31" y2="28"/><line x1="593" x2="593" y2="31"/><line x1="569" x2="569" y2="3"/><line x1="569" x2="569" y1="31" y2="28"/><line x1="544" x2="544" y2="31"/><line x1="519" x2="519" y2="3"/><line x1="519" x2="519" y1="31" y2="28"/><line x1="494" x2="494" y2="31"/><line x1="470" x2="470" y2="3"/><line x1="470" x2="470" y1="31" y2="28"/><line x1="445" x2="445" y2="31"/><line x1="420" x2="420" y2="3"/><line x1="420" x2="420" y1="31" y2="28"/><line x1="396" x2="396" y2="31"/><line x1="371" x2="371" y2="3"/><line x1="371" x2="371" y1="31" y2="28"/><line x1="346" x2="346" y2="31"/><line x1="321" x2="321" y2="3"/><line x1="321" x2="321" y1="31" y2="28"/><line x1="297" x2="297" y2="31"/><line x1="272" x2="272" y2="3"/><line x1="272" x2="272" y1="31" y2="28"/><line x1="247" x2="247" y2="31"/><line x1="222" x2="222" y2="3"/><line x1="222" x2="222" y1="31" y2="28"/><line x1="198" x2="198" y2="31"/><line x1="173" x2="173" y2="3"/><line x1="173" x2="173" y1="31" y2="28"/><line x1="148" x2="148" y2="31"/><line x1="124" x2="124" y2="3"/><line x1="124" x2="124" y1="31" y2="28"/><line x1="99" x2="99" y2="31"/><line x1="74" x2="74" y2="3"/><line x1="74" x2="74" y1="31" y2="28"/><line x1="49" x2="49" y2="31"/><line x1="25" x2="25" y2="3"/><line x1="25" x2="25" y1="31" y2="28"/></g><g><g/><g transform="translate(12,-11)"><g transform="translate(766)"><text y="6">0</text></g><g transform="translate(742)"><text y="6">1</text></g><g transform="translate(717)"><text y="6">2</text></g><g transform="translate(692)"><text y="6">3</text></g><g transform="translate(667)"><text y="6">4</text></g><g transform="translate(643)"><text y="6">5</text></g><g transform="translate(618)"><text y="6">6</text></g><g transform="translate(593)"><text y="6">7</text></g><g transform="translate(569)"><text y="6">8</text></g><g transform="translate(544)"><text y="6">9</text></g><g transform="translate(519)"><text y="6">10</text></g><g transform="translate(494)"><text y="6">11</text></g><g transform="translate(470)"><text y="6">12</text></g><g transform="translate(445)"><text y="6">13</text></g><g transform="translate(420)"><text y="6">14</text></g><g transform="translate(396)"><text y="6">15</text></g><g transform="translate(371)"><text y="6">16</text></g><g transform="translate(346)"><text y="6">17</text></g><g transform="translate(321)"><text y="6">18</text></g><g transform="translate(297)"><text y="6">19</text></g><g transform="translate(272)"><text y="6">20</text></g><g transform="translate(247)"><text y="6">21</text></g><g transform="translate(222)"><text y="6">22</text></g><g transform="translate(198)"><text y="6">23</text></g><g transform="translate(173)"><text y="6">24</text></g><g transform="translate(148)"><text y="6">25</text></g><g transform="translate(124)"><text y="6">26</text></g><g transform="translate(99)"><text y="6">27</text></g><g transform="translate(74)"><text y="6">28</text></g><g transform="translate(49)"><text y="6">29</text></g><g transform="translate(25)"><text y="6">30</text></g><g transform="translate(0)"><text y="6">31</text></g></g><g transform="translate(12,15)"><g transform="translate(754)"><text y="6"><tspan>IS0</tspan></text></g><g transform="translate(704)"><text y="6"><tspan>IS1</tspan></text></g><g transform="translate(655)"><text y="6"><tspan>IS2</tspan></text></g><g transform="translate(606)"><text y="6"><tspan>IS3</tspan></text></g><g transform="translate(556)"><text y="6"><tspan>IS4</tspan></text></g><g transform="translate(507)"><text y="6"><tspan>IS5</tspan></text></g><g transform="translate(457)"><text y="6"><tspan>IS6</tspan></text></g><g transform="translate(408)"><text y="6"><tspan>IS7</tspan></text></g><g transform="translate(358)"><text y="6"><tspan>IS8</tspan></text></g><g transform="translate(309)"><text y="6"><tspan>IS9</tspan></text></g><g transform="translate(260)"><text y="6"><tspan>IS10</tspan></text></g><g transform="translate(210)"><text y="6"><tspan>IS11</tspan></text></g><g transform="translate(161)"><text y="6"><tspan>IS12</tspan></text></g><g transform="translate(111)"><text y="6"><tspan>IS13</tspan></text></g><g transform="translate(62)"><text y="6"><tspan>IS14</tspan></text></g><g transform="translate(12)"><text y="6"><tspan>IS15</tspan></text></g></g><g transform="translate(12,39)"><g transform="translate(754)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(704)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(655)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(606)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(556)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(507)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(457)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(408)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(358)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(309)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(260)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(210)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(161)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(111)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(62)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(12)"><text y="6"><tspan>RW</tspan></text></g></g></g></g></g></svg>

Each `ISx` field controls the two-stage synchronizer between `self.pins[x].i` and `I_DATA.IDx`:
- setting `ISx[0]` to 1 bypasses the first stage of the synchronizer.
- setting `ISx[1]` to 1 bypasses the second stage of the synchronizer.

Each synchronizer stage adds one clock cycle of latency to the input path.

#### I_DATA (read-only)

<svg xmlns="http://www.w3.org/2000/svg" width="800" height="140" viewBox="0 0 800 140" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(0.5,0.5)" text-anchor="middle" font-size="14" font-family="sans-serif" font-weight="normal"><g transform="translate(4,91)"><g stroke="black" stroke-width="1" stroke-linecap="round"><line x2="791"/><line y2="31"/><line x2="791" y1="31" y2="31"/><line x1="791" x2="791" y2="31"/><line x1="742" x2="742" y2="31"/><line x1="692" x2="692" y2="31"/><line x1="643" x2="643" y2="31"/><line x1="593" x2="593" y2="31"/><line x1="544" x2="544" y2="31"/><line x1="494" x2="494" y2="31"/><line x1="445" x2="445" y2="31"/><line x1="396" x2="396" y2="31"/><line x1="346" x2="346" y2="31"/><line x1="297" x2="297" y2="31"/><line x1="247" x2="247" y2="31"/><line x1="198" x2="198" y2="31"/><line x1="148" x2="148" y2="31"/><line x1="99" x2="99" y2="31"/><line x1="49" x2="49" y2="31"/></g><g><g/><g transform="translate(25,-11)"><g transform="translate(742)"><text y="6">0</text></g><g transform="translate(692)"><text y="6">1</text></g><g transform="translate(643)"><text y="6">2</text></g><g transform="translate(593)"><text y="6">3</text></g><g transform="translate(544)"><text y="6">4</text></g><g transform="translate(494)"><text y="6">5</text></g><g transform="translate(445)"><text y="6">6</text></g><g transform="translate(396)"><text y="6">7</text></g><g transform="translate(346)"><text y="6">8</text></g><g transform="translate(297)"><text y="6">9</text></g><g transform="translate(247)"><text y="6">10</text></g><g transform="translate(198)"><text y="6">11</text></g><g transform="translate(148)"><text y="6">12</text></g><g transform="translate(99)"><text y="6">13</text></g><g transform="translate(49)"><text y="6">14</text></g><g transform="translate(0)"><text y="6">15</text></g></g><g transform="translate(25,15)"><g transform="translate(742)"><text y="6"><tspan>ID0</tspan></text></g><g transform="translate(692)"><text y="6"><tspan>ID1</tspan></text></g><g transform="translate(643)"><text y="6"><tspan>ID2</tspan></text></g><g transform="translate(593)"><text y="6"><tspan>ID3</tspan></text></g><g transform="translate(544)"><text y="6"><tspan>ID4</tspan></text></g><g transform="translate(494)"><text y="6"><tspan>ID5</tspan></text></g><g transform="translate(445)"><text y="6"><tspan>ID6</tspan></text></g><g transform="translate(396)"><text y="6"><tspan>ID7</tspan></text></g><g transform="translate(346)"><text y="6"><tspan>ID8</tspan></text></g><g transform="translate(297)"><text y="6"><tspan>ID9</tspan></text></g><g transform="translate(247)"><text y="6"><tspan>ID10</tspan></text></g><g transform="translate(198)"><text y="6"><tspan>ID11</tspan></text></g><g transform="translate(148)"><text y="6"><tspan>ID12</tspan></text></g><g transform="translate(99)"><text y="6"><tspan>ID13</tspan></text></g><g transform="translate(49)"><text y="6"><tspan>ID14</tspan></text></g><g transform="translate(0)"><text y="6"><tspan>ID15</tspan></text></g></g><g transform="translate(25,39)"><g transform="translate(742)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(692)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(643)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(593)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(544)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(494)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(445)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(396)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(346)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(297)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(247)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(198)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(148)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(99)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(49)"><text y="6"><tspan>R</tspan></text></g><g transform="translate(0)"><text y="6"><tspan>R</tspan></text></g></g></g></g><g transform="translate(4,21)"><g stroke="black" stroke-width="1" stroke-linecap="round"><line x2="791"/><line y2="31"/><line x2="791" y1="31" y2="31"/><line x1="791" x2="791" y2="31"/><line x1="742" x2="742" y2="3"/><line x1="742" x2="742" y1="31" y2="28"/><line x1="692" x2="692" y2="3"/><line x1="692" x2="692" y1="31" y2="28"/><line x1="643" x2="643" y2="3"/><line x1="643" x2="643" y1="31" y2="28"/><line x1="593" x2="593" y2="3"/><line x1="593" x2="593" y1="31" y2="28"/><line x1="544" x2="544" y2="3"/><line x1="544" x2="544" y1="31" y2="28"/><line x1="494" x2="494" y2="3"/><line x1="494" x2="494" y1="31" y2="28"/><line x1="445" x2="445" y2="3"/><line x1="445" x2="445" y1="31" y2="28"/><line x1="396" x2="396" y2="3"/><line x1="396" x2="396" y1="31" y2="28"/><line x1="346" x2="346" y2="3"/><line x1="346" x2="346" y1="31" y2="28"/><line x1="297" x2="297" y2="3"/><line x1="297" x2="297" y1="31" y2="28"/><line x1="247" x2="247" y2="3"/><line x1="247" x2="247" y1="31" y2="28"/><line x1="198" x2="198" y2="3"/><line x1="198" x2="198" y1="31" y2="28"/><line x1="148" x2="148" y2="3"/><line x1="148" x2="148" y1="31" y2="28"/><line x1="99" x2="99" y2="3"/><line x1="99" x2="99" y1="31" y2="28"/><line x1="49" x2="49" y2="3"/><line x1="49" x2="49" y1="31" y2="28"/></g><g><g><rect width="791" height="31" style="fill-opacity:0.1"/></g><g transform="translate(25,-11)"><g transform="translate(742)"><text y="6">16</text></g><g transform="translate(0)"><text y="6">31</text></g></g><g transform="translate(25,15)"/><g transform="translate(25,39)"><g transform="translate(371)"><text y="6"><tspan>ResR0W0</tspan></text></g></g></g></g></g></svg>

Each `IDx` field holds the last value of `self.pins[x].i` sampled on a clock cycle. If `MODE.Mx` is not equal `INPUT`, the value of `IDx` is undefined.

#### O_DATA (read/write)

<svg xmlns="http://www.w3.org/2000/svg" width="800" height="140" viewBox="0 0 800 140" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(0.5,0.5)" text-anchor="middle" font-size="14" font-family="sans-serif" font-weight="normal"><g transform="translate(4,91)"><g stroke="black" stroke-width="1" stroke-linecap="round"><line x2="791"/><line y2="31"/><line x2="791" y1="31" y2="31"/><line x1="791" x2="791" y2="31"/><line x1="742" x2="742" y2="31"/><line x1="692" x2="692" y2="31"/><line x1="643" x2="643" y2="31"/><line x1="593" x2="593" y2="31"/><line x1="544" x2="544" y2="31"/><line x1="494" x2="494" y2="31"/><line x1="445" x2="445" y2="31"/><line x1="396" x2="396" y2="31"/><line x1="346" x2="346" y2="31"/><line x1="297" x2="297" y2="31"/><line x1="247" x2="247" y2="31"/><line x1="198" x2="198" y2="31"/><line x1="148" x2="148" y2="31"/><line x1="99" x2="99" y2="31"/><line x1="49" x2="49" y2="31"/></g><g><g/><g transform="translate(25,-11)"><g transform="translate(742)"><text y="6">0</text></g><g transform="translate(692)"><text y="6">1</text></g><g transform="translate(643)"><text y="6">2</text></g><g transform="translate(593)"><text y="6">3</text></g><g transform="translate(544)"><text y="6">4</text></g><g transform="translate(494)"><text y="6">5</text></g><g transform="translate(445)"><text y="6">6</text></g><g transform="translate(396)"><text y="6">7</text></g><g transform="translate(346)"><text y="6">8</text></g><g transform="translate(297)"><text y="6">9</text></g><g transform="translate(247)"><text y="6">10</text></g><g transform="translate(198)"><text y="6">11</text></g><g transform="translate(148)"><text y="6">12</text></g><g transform="translate(99)"><text y="6">13</text></g><g transform="translate(49)"><text y="6">14</text></g><g transform="translate(0)"><text y="6">15</text></g></g><g transform="translate(25,15)"><g transform="translate(742)"><text y="6"><tspan>OD0</tspan></text></g><g transform="translate(692)"><text y="6"><tspan>OD1</tspan></text></g><g transform="translate(643)"><text y="6"><tspan>OD2</tspan></text></g><g transform="translate(593)"><text y="6"><tspan>OD3</tspan></text></g><g transform="translate(544)"><text y="6"><tspan>OD4</tspan></text></g><g transform="translate(494)"><text y="6"><tspan>OD5</tspan></text></g><g transform="translate(445)"><text y="6"><tspan>OD6</tspan></text></g><g transform="translate(396)"><text y="6"><tspan>OD7</tspan></text></g><g transform="translate(346)"><text y="6"><tspan>OD8</tspan></text></g><g transform="translate(297)"><text y="6"><tspan>OD9</tspan></text></g><g transform="translate(247)"><text y="6"><tspan>OD10</tspan></text></g><g transform="translate(198)"><text y="6"><tspan>OD11</tspan></text></g><g transform="translate(148)"><text y="6"><tspan>OD12</tspan></text></g><g transform="translate(99)"><text y="6"><tspan>OD13</tspan></text></g><g transform="translate(49)"><text y="6"><tspan>OD14</tspan></text></g><g transform="translate(0)"><text y="6"><tspan>OD15</tspan></text></g></g><g transform="translate(25,39)"><g transform="translate(742)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(692)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(643)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(593)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(544)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(494)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(445)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(396)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(346)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(297)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(247)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(198)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(148)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(99)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(49)"><text y="6"><tspan>RW</tspan></text></g><g transform="translate(0)"><text y="6"><tspan>RW</tspan></text></g></g></g></g><g transform="translate(4,21)"><g stroke="black" stroke-width="1" stroke-linecap="round"><line x2="791"/><line y2="31"/><line x2="791" y1="31" y2="31"/><line x1="791" x2="791" y2="31"/><line x1="742" x2="742" y2="3"/><line x1="742" x2="742" y1="31" y2="28"/><line x1="692" x2="692" y2="3"/><line x1="692" x2="692" y1="31" y2="28"/><line x1="643" x2="643" y2="3"/><line x1="643" x2="643" y1="31" y2="28"/><line x1="593" x2="593" y2="3"/><line x1="593" x2="593" y1="31" y2="28"/><line x1="544" x2="544" y2="3"/><line x1="544" x2="544" y1="31" y2="28"/><line x1="494" x2="494" y2="3"/><line x1="494" x2="494" y1="31" y2="28"/><line x1="445" x2="445" y2="3"/><line x1="445" x2="445" y1="31" y2="28"/><line x1="396" x2="396" y2="3"/><line x1="396" x2="396" y1="31" y2="28"/><line x1="346" x2="346" y2="3"/><line x1="346" x2="346" y1="31" y2="28"/><line x1="297" x2="297" y2="3"/><line x1="297" x2="297" y1="31" y2="28"/><line x1="247" x2="247" y2="3"/><line x1="247" x2="247" y1="31" y2="28"/><line x1="198" x2="198" y2="3"/><line x1="198" x2="198" y1="31" y2="28"/><line x1="148" x2="148" y2="3"/><line x1="148" x2="148" y1="31" y2="28"/><line x1="99" x2="99" y2="3"/><line x1="99" x2="99" y1="31" y2="28"/><line x1="49" x2="49" y2="3"/><line x1="49" x2="49" y1="31" y2="28"/></g><g><g><rect width="791" height="31" style="fill-opacity:0.1"/></g><g transform="translate(25,-11)"><g transform="translate(742)"><text y="6">16</text></g><g transform="translate(0)"><text y="6">31</text></g></g><g transform="translate(25,15)"/><g transform="translate(25,39)"><g transform="translate(371)"><text y="6"><tspan>ResR0W0</tspan></text></g></g></g></g></g></svg>

Each `ODx` field holds the next value of `self.pins[x].o`. This value may be overriden by `O_MASK.OSx` or `O_MASK.OCx` if either is non-zero.

#### O_MASK (read/write)

<svg xmlns="http://www.w3.org/2000/svg" width="800" height="140" viewBox="0 0 800 140" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(0.5,0.5)" text-anchor="middle" font-size="14" font-family="sans-serif" font-weight="normal"><g transform="translate(4,91)"><g stroke="black" stroke-width="1" stroke-linecap="round"><line x2="791"/><line y2="31"/><line x2="791" y1="31" y2="31"/><line x1="791" x2="791" y2="31"/><line x1="742" x2="742" y2="31"/><line x1="692" x2="692" y2="31"/><line x1="643" x2="643" y2="31"/><line x1="593" x2="593" y2="31"/><line x1="544" x2="544" y2="31"/><line x1="494" x2="494" y2="31"/><line x1="445" x2="445" y2="31"/><line x1="396" x2="396" y2="31"/><line x1="346" x2="346" y2="31"/><line x1="297" x2="297" y2="31"/><line x1="247" x2="247" y2="31"/><line x1="198" x2="198" y2="31"/><line x1="148" x2="148" y2="31"/><line x1="99" x2="99" y2="31"/><line x1="49" x2="49" y2="31"/></g><g><g/><g transform="translate(25,-11)"><g transform="translate(742)"><text y="6">0</text></g><g transform="translate(692)"><text y="6">1</text></g><g transform="translate(643)"><text y="6">2</text></g><g transform="translate(593)"><text y="6">3</text></g><g transform="translate(544)"><text y="6">4</text></g><g transform="translate(494)"><text y="6">5</text></g><g transform="translate(445)"><text y="6">6</text></g><g transform="translate(396)"><text y="6">7</text></g><g transform="translate(346)"><text y="6">8</text></g><g transform="translate(297)"><text y="6">9</text></g><g transform="translate(247)"><text y="6">10</text></g><g transform="translate(198)"><text y="6">11</text></g><g transform="translate(148)"><text y="6">12</text></g><g transform="translate(99)"><text y="6">13</text></g><g transform="translate(49)"><text y="6">14</text></g><g transform="translate(0)"><text y="6">15</text></g></g><g transform="translate(25,15)"><g transform="translate(742)"><text y="6"><tspan>OS0</tspan></text></g><g transform="translate(692)"><text y="6"><tspan>OS1</tspan></text></g><g transform="translate(643)"><text y="6"><tspan>OS2</tspan></text></g><g transform="translate(593)"><text y="6"><tspan>OS3</tspan></text></g><g transform="translate(544)"><text y="6"><tspan>OS4</tspan></text></g><g transform="translate(494)"><text y="6"><tspan>OS5</tspan></text></g><g transform="translate(445)"><text y="6"><tspan>OS6</tspan></text></g><g transform="translate(396)"><text y="6"><tspan>OS7</tspan></text></g><g transform="translate(346)"><text y="6"><tspan>OS8</tspan></text></g><g transform="translate(297)"><text y="6"><tspan>OS9</tspan></text></g><g transform="translate(247)"><text y="6"><tspan>OS10</tspan></text></g><g transform="translate(198)"><text y="6"><tspan>OS11</tspan></text></g><g transform="translate(148)"><text y="6"><tspan>OS12</tspan></text></g><g transform="translate(99)"><text y="6"><tspan>OS13</tspan></text></g><g transform="translate(49)"><text y="6"><tspan>OS14</tspan></text></g><g transform="translate(0)"><text y="6"><tspan>OS15</tspan></text></g></g><g transform="translate(25,39)"><g transform="translate(742)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(692)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(643)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(593)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(544)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(494)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(445)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(396)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(346)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(297)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(247)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(198)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(148)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(99)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(49)"><text y="6"><tspan>RW1S</tspan></text></g><g transform="translate(0)"><text y="6"><tspan>RW1S</tspan></text></g></g></g></g><g transform="translate(4,21)"><g stroke="black" stroke-width="1" stroke-linecap="round"><line x2="791"/><line y2="31"/><line x2="791" y1="31" y2="31"/><line x1="791" x2="791" y2="31"/><line x1="742" x2="742" y2="31"/><line x1="692" x2="692" y2="31"/><line x1="643" x2="643" y2="31"/><line x1="593" x2="593" y2="31"/><line x1="544" x2="544" y2="31"/><line x1="494" x2="494" y2="31"/><line x1="445" x2="445" y2="31"/><line x1="396" x2="396" y2="31"/><line x1="346" x2="346" y2="31"/><line x1="297" x2="297" y2="31"/><line x1="247" x2="247" y2="31"/><line x1="198" x2="198" y2="31"/><line x1="148" x2="148" y2="31"/><line x1="99" x2="99" y2="31"/><line x1="49" x2="49" y2="31"/></g><g><g/><g transform="translate(25,-11)"><g transform="translate(742)"><text y="6">16</text></g><g transform="translate(692)"><text y="6">17</text></g><g transform="translate(643)"><text y="6">18</text></g><g transform="translate(593)"><text y="6">19</text></g><g transform="translate(544)"><text y="6">20</text></g><g transform="translate(494)"><text y="6">21</text></g><g transform="translate(445)"><text y="6">22</text></g><g transform="translate(396)"><text y="6">23</text></g><g transform="translate(346)"><text y="6">24</text></g><g transform="translate(297)"><text y="6">25</text></g><g transform="translate(247)"><text y="6">26</text></g><g transform="translate(198)"><text y="6">27</text></g><g transform="translate(148)"><text y="6">28</text></g><g transform="translate(99)"><text y="6">29</text></g><g transform="translate(49)"><text y="6">30</text></g><g transform="translate(0)"><text y="6">31</text></g></g><g transform="translate(25,15)"><g transform="translate(742)"><text y="6"><tspan>OC0</tspan></text></g><g transform="translate(692)"><text y="6"><tspan>OC1</tspan></text></g><g transform="translate(643)"><text y="6"><tspan>OC2</tspan></text></g><g transform="translate(593)"><text y="6"><tspan>OC3</tspan></text></g><g transform="translate(544)"><text y="6"><tspan>OC4</tspan></text></g><g transform="translate(494)"><text y="6"><tspan>OC5</tspan></text></g><g transform="translate(445)"><text y="6"><tspan>OC6</tspan></text></g><g transform="translate(396)"><text y="6"><tspan>OC7</tspan></text></g><g transform="translate(346)"><text y="6"><tspan>OC8</tspan></text></g><g transform="translate(297)"><text y="6"><tspan>OC9</tspan></text></g><g transform="translate(247)"><text y="6"><tspan>OC10</tspan></text></g><g transform="translate(198)"><text y="6"><tspan>OC11</tspan></text></g><g transform="translate(148)"><text y="6"><tspan>OC12</tspan></text></g><g transform="translate(99)"><text y="6"><tspan>OC13</tspan></text></g><g transform="translate(49)"><text y="6"><tspan>OC14</tspan></text></g><g transform="translate(0)"><text y="6"><tspan>OC15</tspan></text></g></g><g transform="translate(25,39)"><g transform="translate(742)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(692)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(643)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(593)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(544)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(494)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(445)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(396)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(346)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(297)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(247)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(198)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(148)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(99)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(49)"><text y="6"><tspan>RW1C</tspan></text></g><g transform="translate(0)"><text y="6"><tspan>RW1C</tspan></text></g></g></g></g></g></svg>

From highest to lowest precedence, the next value of `self.pins[x].o` is:
- `1`, if `O_MASK.OSx = 1`
- `0`, if `O_MASK.OCx = 1`
- `O_DATA.ODx`

## Reference-level explanation
[reference-level-explanation]: #reference-level-explanation

### `amaranth_soc.csr.gpio.PinSignature`

The `PinSignature` class is a `wiring.Signature` describing the interface between the GPIO peripheral and a single pin.

The members of a `PinSignature` are defined as follows:

```python3
{
    "i":  In(unsigned(1)),
    "o":  Out(unsigned(1)),
    "oe": Out(unsigned(1)),
}
```

### `amaranth_soc.csr.gpio.GPIOPeripheral`

The `GPIOPeripheral` class is a `wiring.Component` implementing a GPIO controller, with:
- a `.__init__(self, *, addr_width, data_width, name=None, pin_count=16)` constructor, where:
  * `addr_width`, `data_width` and `name` are passed to a `csr.Builder`
  * `pin_count` is an integer between 0 and 16.
- a `.signature` property, that returns a `wiring.Signature` with the following members:

```python3
{
    "bus": In(csr.Signature(addr_width, data_width)),
    "pins": Out(PinSignature()).array(pin_count),
}
```

- a `.elaborate(self, platform)` method, that connects each pin in `self.pins` to its associated fields in the registers exposed by `self.bus`.

## Drawbacks
[drawbacks]: #drawbacks

While existing implementations (such as STM32 GPIOs) have features like pin multiplexing and configurable pull-up/down resistors, in the proposed design, those would have to be implemented in a separate component.

## Rationale and alternatives
[rationale-and-alternatives]: #rationale-and-alternatives

The proposed design moves platform-specific details outside of its scope, which:
- reduces the amount of non-portable code to maintain, while allowing implementation freedom for users needing it.
- avoids introducing dependencies on upstream APIs that are deprecated or expected to evolve soon (such as `amaranth.build`).

As an alternative:
- do not host any peripheral in amaranth-soc and always develop them downstream.
- include a pin multiplexer inside the GPIO peripheral.

## Prior art
[prior-art]: #prior-art

While they can be found in most microcontollers, the design of GPIOs in STM32 and ESP32-C3 have inspired part of this RFC.

## Unresolved questions
[unresolved-questions]: #unresolved-questions

- Should we support synchronizing a pin input on falling edges of the clock ?
- How should we handle more than 16 GPIO pins ? With larger registers, multiple peripherals, or an array of "GPIO ports" ?

## Future possibilities
[future-possibilities]: #future-possibilities

- Implement a pin multiplexer peripheral, that can be composed with this one to allow reusing other pins of a SoC as GPIOs.
